services:
  # Backend Assist API
  backend-assist-api:
    build:
      context: .
      dockerfile: apps/backend-assist-api/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8000
      - MONGODB_URI=${MONGODB_URI}
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET}
      - BETTER_AUTH_URL=${BETTER_AUTH_URL}
      - CLIENT_URL=${CLIENT_URL}
      - DEFAULT_FROM_EMAIL=${DEFAULT_FROM_EMAIL}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASS=${SMTP_PASS}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - GOOGLE_REDIRECT_URI=${GOOGLE_REDIRECT_URI}
      - GMAIL_PUBSUB_TOPIC=${GMAIL_PUBSUB_TOPIC}
    restart: unless-stopped
    networks:
      - dokploy-network

  # Backend Assist Web
  backend-assist-web:
    build:
      context: .
      dockerfile: apps/backend-assist-web/Dockerfile
      args:
        BA_BETTER_AUTH_URL: ${BETTER_AUTH_URL}
        BA_CLIENT_URL: ${CLIENT_URL}
    environment:
      - NODE_ENV=production
      - PORT=3000
      - NEXT_PUBLIC_AUTH_URL=${BETTER_AUTH_URL}
      - NEXT_PUBLIC_CLIENT_URL=${CLIENT_URL}
    depends_on:
      - backend-assist-api
    restart: unless-stopped
    networks:
      - dokploy-network

  # Widget UI
  widget-ui:
    build:
      context: .
      dockerfile: apps/widget-ui/Dockerfile
      args:
        VITE_BACKEND_API_URL: ${BETTER_AUTH_URL}
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    networks:
      - dokploy-network

networks:
  dokploy-network:
    external: true
