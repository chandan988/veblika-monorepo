services:
  # Backend Assist API
  backend-assist-api:
    build:
      context: .
      dockerfile: apps/backend-assist-api/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8000
      - MONGODB_URI=${BA_MONGODB_URI}
      - BETTER_AUTH_SECRET=${BA_BETTER_AUTH_SECRET}
      - BETTER_AUTH_URL=${BA_BETTER_AUTH_URL}
      - CLIENT_URL=${BA_CLIENT_URL}
      - DEFAULT_FROM_EMAIL=${BA_DEFAULT_FROM_EMAIL}
      - SMTP_HOST=${BA_SMTP_HOST}
      - SMTP_PORT=${BA_SMTP_PORT}
      - SMTP_USER=${BA_SMTP_USER}
      - SMTP_PASS=${BA_SMTP_PASS}
      - GOOGLE_CLIENT_ID=${BA_GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${BA_GOOGLE_CLIENT_SECRET}
      - GOOGLE_REDIRECT_URI=${BA_GOOGLE_REDIRECT_URI}
      - GMAIL_PUBSUB_TOPIC=${BA_GMAIL_PUBSUB_TOPIC}
    restart: unless-stopped
    networks:
      - dokploy-network

  # Backend Assist Web
  backend-assist-web:
    build:
      context: .
      dockerfile: apps/backend-assist-web/Dockerfile
      args:
        BA_BETTER_AUTH_URL: ${BA_BETTER_AUTH_URL}
        BA_CLIENT_URL: ${BA_CLIENT_URL}
    environment:
      - NODE_ENV=production
      - PORT=3000
      - NEXT_PUBLIC_AUTH_URL=${BA_BETTER_AUTH_URL}
      - NEXT_PUBLIC_CLIENT_URL=${BA_CLIENT_URL}
    depends_on:
      - backend-assist-api
    restart: unless-stopped
    networks:
      - dokploy-network

  # Social Media API
  social-media-api:
    build:
      context: .
      dockerfile: apps/social-media-api/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8001
      - MONGO_URL=${SM_MONGO_URL}
      - JWT_SECRET=${SM_JWT_SECRET}
      - FRONTEND_URL=${SM_FRONTEND_URL}
      - AWS_REGION=${SM_AWS_REGION}
      - BUCKETNAME=${SM_BUCKETNAME}
      - S3ACCESSKEYID=${SM_S3ACCESSKEYID}
      - S3ACCESSKEY=${SM_S3ACCESSKEY}
      - S3_ENDPOINT=${SM_S3_ENDPOINT}
      - META_APP_ID=${SM_META_APP_ID}
      - META_APP_SECRET=${SM_META_APP_SECRET}
      - INSTAGRAM_APP_ID=${SM_INSTAGRAM_APP_ID}
      - INSTAGRAM_APP_SECRET=${SM_INSTAGRAM_APP_SECRET}
      - INSTAGRAM_REDIRECT_URI=${SM_INSTAGRAM_REDIRECT_URI}
      - FACEBOOK_REDIRECT_URI=${SM_FACEBOOK_REDIRECT_URI}
      - LINKEDIN_CLIENT_ID=${SM_LINKEDIN_CLIENT_ID}
      - LINKEDIN_CLIENT_SECRET=${SM_LINKEDIN_CLIENT_SECRET}
      - LINKEDIN_REDIRECT_URI=${SM_LINKEDIN_REDIRECT_URI}
      - YOUTUBE_CLIENT_ID=${SM_YOUTUBE_CLIENT_ID}
      - YOUTUBE_CLIENT_SECRET=${SM_YOUTUBE_CLIENT_SECRET}
      - YOUTUBE_REDIRECT_URI=${SM_YOUTUBE_REDIRECT_URI}
    restart: unless-stopped
    networks:
      - dokploy-network

  # Social Media Web
  social-media-web:
    build:
      context: .
      dockerfile: apps/social-media-web/Dockerfile
      args:
        SM_FRONTEND_URL: ${SM_FRONTEND_URL}
    environment:
      - NODE_ENV=production
      - PORT=3001
      - NEXT_PUBLIC_API_URL=${SM_FRONTEND_URL}
    depends_on:
      - social-media-api
    restart: unless-stopped
    networks:
      - dokploy-network

  # Widget UI
  widget-ui:
    build:
      context: .
      dockerfile: apps/widget-ui/Dockerfile
      args:
        VITE_BACKEND_API_URL: ${BA_BETTER_AUTH_URL}
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    networks:
      - dokploy-network

networks:
  dokploy-network:
    external: true
