services:
  auth:
    build:
      context: .
      dockerfile: apps/auth/Dockerfile
      args:
        # Only NEXT_PUBLIC_ at build time
        NEXT_PUBLIC_AUTH_URL: ${NEXT_PUBLIC_AUTH_URL}
    environment:
      # All these at runtime
      NODE_ENV: production
      BETTER_AUTH_SECRET: ${BETTER_AUTH_SECRET}
      BETTER_AUTH_URL: ${BETTER_AUTH_URL}
      DATABASE_URL: ${DATABASE_URL}
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      DEFAULT_FROM_EMAIL: ${DEFAULT_FROM_EMAIL}
      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASS: ${SMTP_PASS}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - dokploy-network

networks:
  dokploy-network:
    external: true